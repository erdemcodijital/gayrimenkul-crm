import { notFound } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import { Database } from '@/lib/database.types';

type Agent = Database['public']['Tables']['agents']['Row'];

interface PageProps {
  params: {
    domain: string;
  };
}

async function getAgent(domain: string): Promise<Agent | null> {
  console.log('ğŸ” Aranan domain:', domain);
  
  const { data, error } = await supabase
    .from('agents')
    .select('*')
    .eq('domain', domain)
    .eq('is_active', true)
    .single();

  console.log('ğŸ“Š Supabase yanÄ±tÄ±:', { data, error });

  if (error || !data) {
    console.log('âŒ DanÄ±ÅŸman bulunamadÄ±:', error?.message);
    return null;
  }

  console.log('âœ… DanÄ±ÅŸman bulundu:', data.name);
  return data;
}

export default async function AgentPage({ params }: PageProps) {
  const agent = await getAgent(params.domain);

  if (!agent) {
    notFound();
  }

  // Basit test sayfasÄ±
  return (
    <div style={{ padding: '50px', fontFamily: 'Arial' }}>
      <h1>âœ… Sayfa Ã‡alÄ±ÅŸÄ±yor!</h1>
      <h2>DanÄ±ÅŸman Bilgileri:</h2>
      <ul>
        <li><strong>Ad:</strong> {agent.name}</li>
        <li><strong>Email:</strong> {agent.email}</li>
        <li><strong>Åehir:</strong> {agent.city}</li>
        <li><strong>Domain:</strong> {agent.domain}</li>
        <li><strong>Telefon:</strong> {agent.phone}</li>
      </ul>
    </div>
  );
}
